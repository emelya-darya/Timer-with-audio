"use strict";const allAudioTitles=Array.from(document.querySelectorAll(".sounds__item-title")),allAudios=Array.from(document.querySelectorAll(".sounds__audio")),currentAudio=document.querySelector(".sounds__current-audio"),playPauseBtn=document.querySelector(".player__play-pause"),progStrip=document.querySelector(".progressbar__strip"),progTodd=document.querySelector(".progressbar__toddler"),progDot=document.querySelector(".progressbar__toddler-dot"),progCurTime=document.querySelector(".progressbar__current-time"),progDuration=document.querySelector(".progressbar__duration"),volIcon=document.querySelector(".volume-icon"),volStrip=document.querySelector(".player__volume-strip"),volTodd=document.querySelector(".player__volume-toddler"),volDot=document.querySelector(".volume__toddler-dot");function replacement(e){let t=e.currentTarget.nextElementSibling.getAttribute("src");currentAudio.setAttribute("src",t),currentAudio.play(),document.querySelector(".sounds__item-title._selected")&&document.querySelector(".sounds__item-title._selected").classList.remove("_selected"),e.currentTarget.classList.add("_selected"),playPauseBtn.querySelector("use").setAttribute("href","img/icons/symbol/sprite.svg#pause")}
//! Пауза-проигрывание и изменение текущего времени проигрывания и работа с прогрессбаром
function playPauseA(){if(currentAudio.paused)currentAudio.play(),playPauseBtn.querySelector("use").setAttribute("href","img/icons/symbol/sprite.svg#pause");else{let e=currentAudio.play();void 0!==e&&e.then((()=>{currentAudio.pause(),playPauseBtn.querySelector("use").setAttribute("href","img/icons/symbol/sprite.svg#play")}))}}function progPlay(e){let t=100*this.currentTime/this.duration;progTodd.style.width=`${t}%`;let o=Math.floor(this.currentTime%60),r=Math.floor(this.duration%60);progCurTime.innerHTML=`${Math.floor(this.currentTime/60)}: \n\t\t\t${o<10?"0"+o:o}`,progDuration.innerHTML=`${Math.floor(this.duration/60)}: \n\t\t\t${r<10?"0"+r:r}`}currentAudio.addEventListener("loadedmetadata",(()=>{progCurTime.innerHTML="0:00",currentAudio.volume=.15;let e=Math.floor(currentAudio.duration%60);progDuration.innerHTML=`${Math.floor(currentAudio.duration/60)}: \n\t\t\t${e<10?"0"+e:e}`})),allAudios.forEach((e=>{e.addEventListener("loadedmetadata",(function(e){let t=Math.floor(this.duration%60);this.previousElementSibling.innerHTML+=`<span style="white-space: nowrap"> &nbsp &nbsp(${Math.floor(this.duration/60)}: \n\t\t\t${t<10?"0"+t:t})</span>`}))})),allAudioTitles.forEach((e=>{e.addEventListener("click",replacement)})),playPauseBtn.addEventListener("click",playPauseA),currentAudio.addEventListener("timeupdate",progPlay);let isGrab=!1,wasPaused=!0;progDot.onmousedown=function(e){isGrab=!0;const t=this,o=progStrip.getBoundingClientRect().left,r=progStrip.getBoundingClientRect().right-8,i=progStrip.getBoundingClientRect().top,n=progStrip.getBoundingClientRect().bottom;if(currentAudio.paused)wasPaused=!0;else{let e=currentAudio.play();void 0!==e&&e.then((()=>{currentAudio.pause(),wasPaused=!1}))}function u(e){if(isGrab){let u=e.pageX,l=e.clientY;if(t.parentElement.style.position="static",u>o&&u<r&&l>i-15&&l<n+15){let e=u-o+2;t.style.right=r-o-e+"px",t.parentElement.style.width=100*e/(r-o)+"%"}}}document.addEventListener("mousemove",u),document.addEventListener("mouseup",(function(e){isGrab=!1,t.removeEventListener("mousemove",u),t.parentElement.style.position="relative",t.style.right="-8px",t.style.position="absolute",currentAudio.currentTime=Math.round(currentAudio.duration*(progTodd.offsetWidth/progStrip.offsetWidth)),wasPaused||currentAudio.play()}),{once:!0})},progStrip.addEventListener("click",(function(e){let t=progStrip.getBoundingClientRect().left,o=progStrip.getBoundingClientRect().right-8,r=(e.pageX-t)/(o-t);currentAudio.paused?currentAudio.currentTime=Math.round(currentAudio.duration*r):(currentAudio.pause(),currentAudio.currentTime=Math.round(currentAudio.duration*r),setTimeout((()=>{currentAudio.play()}),10))}));
//! Работа со звуком
let isGrabVol=!1;volDot.onmousedown=function(e){isGrabVol=!0;const t=this,o=volStrip.getBoundingClientRect().left,r=volStrip.getBoundingClientRect().right,i=volStrip.getBoundingClientRect().top,n=volStrip.getBoundingClientRect().bottom;function u(e){if(isGrabVol){let u=e.pageX,l=e.clientY;if(volTodd.style.position="static",u>o&&u<r&&l>i-15&&l<n+15){let e=u-o;t.style.right=volStrip.offsetWidth-e+"px",volTodd.style.width=`${Math.ceil(100*e/(r-o))}%`}}}document.addEventListener("mousemove",u),document.addEventListener("mouseup",(function(e){isGrabVol=!1,t.removeEventListener("mousemove",u),volTodd.style.position="relative",t.style.right="0px";let o=(volTodd.offsetWidth/volStrip.offsetWidth).toFixed(2);o<0&&(o=0),currentAudio.volume=o>1?1:o}))},volStrip.addEventListener("click",(function(e){let t=volStrip.getBoundingClientRect().left,o=volStrip.getBoundingClientRect().right,r=e.pageX,i=(r-t)/(o-t)>1?1:(r-t)/(o-t);volTodd.style.width=`${(100*i).toFixed(2)}%`,volDot.style.right="0px";let n=i.toFixed(2)<0?0:i.toFixed(2);currentAudio.volume=n>1?1:n}));let cacheVol=1;currentAudio.addEventListener("volumechange",(function(e){0!=this.volume&&(cacheVol=this.volume),volTodd.style.width=Math.ceil(100*this.volume)+"%"})),volIcon.addEventListener("click",(function(e){currentAudio.volume>0?(currentAudio.volume=0,this.querySelector("use").setAttribute("href","img/icons/symbol/sprite.svg#volume-xmark")):0==currentAudio.volume&&(currentAudio.volume=cacheVol,this.querySelector("use").setAttribute("href","img/icons/symbol/sprite.svg#volume-high"))}));