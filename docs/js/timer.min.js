"use strict";!function(){for(var n=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=(new Date).getTime(),o=Math.max(0,16-(i-n)),r=window.setTimeout((function(){e(i+o)}),o);return n=i+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})}();const isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},seconds=document.querySelector(".clock__seconds"),minutes=document.querySelector(".clock__minutes"),hours=document.querySelector(".clock__hours");let rafId1,rafId2,timerSize,a=Date.now(),c=Date.now();function tickTak(){let n,e,t,i=Date.now(),o=Math.floor((i-a)/1e3),r=timerSize-o;if(r<0)return hours.innerHTML="00",minutes.innerHTML="00",seconds.innerHTML="00",cancelAnimationFrame(rafId1),rafId1=null,void endTimer();n=Math.floor(r/3600),e=Math.floor(r/60-60*n),t=r-3600*n-60*e,hours.innerHTML=n<10?"0"+n:n,minutes.innerHTML=e<10?"0"+e:e,seconds.innerHTML=t<10?"0"+t:t,isPaused||requestAnimationFrame(tickTak)}
//! Анимация таймера (заполняющаяся окружность)
//! Функция "тиканья" таймера к нулю
a=Date.now();const canvClock=document.getElementById("canvas-clock"),context=canvClock.getContext("2d"),w=canvClock.width=canvClock.offsetWidth,h=canvClock.height=canvClock.offsetHeight;let cacheFuncAge=0;const angleInt=2*Math.PI/120;let angle=-.5*Math.PI-angleInt;function timerCircle(){let n=(Date.now()-c)/1e3+cacheFuncAge,e=n/((cacheFuncAge+timerSize)/120);if(e>=120){cacheFuncAge=0;for(let n=0;n<=120;n++)angle+=angleInt,drawStrip();return angle=-.5*Math.PI-angleInt,cancelAnimationFrame(rafId2),void(rafId2=null)}context.clearRect(0,0,w,h);for(let n=0;n<=e;n++)angle+=angleInt,drawStrip();angle=-.5*Math.PI-angleInt,isPaused&&(cacheFuncAge=n),isPaused||requestAnimationFrame(timerCircle)}c=Date.now();const drawStrip=function(){context.fillStyle="#D6BB74",context.strokeStyle="#D6BB74",context.lineWidth=1,context.beginPath(),context.moveTo(w/2+139*Math.cos(angle),h/2+139*Math.sin(angle)),context.lineTo(w/2+147*Math.cos(angle),h/2+147*Math.sin(angle)),context.fill(),context.stroke(),context.closePath()},endTimerSound=document.querySelector(".endTimer"),endTimer=function(){currentAudio.pause(),playPauseBtn.querySelector("use").setAttribute("href","img/icons/symbol/sprite.svg#play"),endTimerSound.volume=.5,endTimerSound.play()};function startTimer(){let n,e,t;n=0==hours.innerHTML[0]?+hours.innerHTML[1]:+hours.innerHTML,e=0==minutes.innerHTML[0]?+minutes.innerHTML[1]:+minutes.innerHTML,t=0==seconds.innerHTML[0]?+seconds.innerHTML[1]:+seconds.innerHTML,timerSize=3600*n+60*e+t,a=Date.now(),rafId1=requestAnimationFrame(tickTak),c=Date.now(),rafId2=requestAnimationFrame(timerCircle)}function handOverTimeVal(){let n=+hoursWindow.innerHTML,e=+minutesWindow.innerHTML,t=+secondsWindow.innerHTML;n<10&&(n="0"+n),e<10&&(e="0"+e),t<10&&(t="0"+t),hours.innerHTML=n,minutes.innerHTML=e,seconds.innerHTML=t}const pauseBtn=document.querySelector(".clock__pause"),runBtn=document.querySelector(".clock__run");let isPaused=!0;function pauseRun(){pauseBtn.classList.toggle("_hidden"),runBtn.classList.toggle("_hidden"),isPaused?isPaused&&(isPaused=!1,startTimer()):isPaused=!0}pauseBtn.addEventListener("click",(()=>{pauseRun()})),runBtn.addEventListener("click",pauseRun);const startBtn=document.querySelector(".settings__start-button");startBtn.addEventListener("click",(function(){cacheFuncAge=0,pauseRun(),handOverTimeVal(),startTimer()}));
//! Задать интервал
const settingsInterval=document.querySelector(".settings__interval"),hoursWindow=document.querySelector(".set-hours__value div span"),minutesWindow=document.querySelector(".set-minutes__value div span"),secondsWindow=document.querySelector(".set-seconds__value div span");let timerId;function changeInterval(n){n.target.closest(".set-hours__value-down")&&(0!=+hoursWindow.innerHTML?hoursWindow.innerHTML=+hoursWindow.innerHTML-1:0==+hoursWindow.innerHTML&&(hoursWindow.innerHTML=99)),n.target.closest(".set-hours__value-up")&&(+hoursWindow.innerHTML<99?hoursWindow.innerHTML=+hoursWindow.innerHTML+1:99==+hoursWindow.innerHTML&&(hoursWindow.innerHTML=0)),n.target.closest(".set-minutes__value-down")&&(0!=+minutesWindow.innerHTML?minutesWindow.innerHTML=+minutesWindow.innerHTML-1:0==+minutesWindow.innerHTML&&(minutesWindow.innerHTML=59)),n.target.closest(".set-minutes__value-up")&&(+minutesWindow.innerHTML<=58?minutesWindow.innerHTML=+minutesWindow.innerHTML+1:59==+minutesWindow.innerHTML&&(minutesWindow.innerHTML=0)),n.target.closest(".set-seconds__value-down")&&(0!=+secondsWindow.innerHTML?secondsWindow.innerHTML=+secondsWindow.innerHTML-1:0==+secondsWindow.innerHTML&&(secondsWindow.innerHTML=59)),n.target.closest(".set-seconds__value-up")&&(+secondsWindow.innerHTML<=58?secondsWindow.innerHTML=+secondsWindow.innerHTML+1:59==+secondsWindow.innerHTML&&(secondsWindow.innerHTML=0))}let isPress=!1;isMobile.any()?isMobile.any()&&settingsInterval.addEventListener("click",(function(n){changeInterval(n)})):(settingsInterval.addEventListener("mousedown",(function(n){isPress=!0,isPress&&(timerId=setInterval(changeInterval,100,n))})),settingsInterval.addEventListener("mouseup",(function(n){isPress=!1,clearTimeout(timerId)})),settingsInterval.addEventListener("mouseout",(function(n){isPress=!1,clearTimeout(timerId)})));
